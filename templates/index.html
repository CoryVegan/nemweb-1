<!doctype html>
<html>
<head>
	<title>NemWeb</title>
	<meta charset="utf-8">
<meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">	
  <link href="static/css/bootstrap.min.css" rel="stylesheet">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
	<script>

        // JSONP request
        var jsonData = $.ajax({
          url: '/dispatch',
          dataType: 'json',
        }).done(function (results) {

//TODO ewww yuck - just loop through you idiot
	data = results['results']
regions = ["QLD1","NSW1","SA1","TAS1","VIC1"]
price = {}
demand = {}
generation = {}
for( i =0; i<regions.length; i++){
region = regions[i];
price[region] = []
generation[region] = []
demand[region] = []
}


for(i in data){
row = data[i];
for( i =0; i<regions.length; i++){
region = regions[i];
price[region].push([Date.parse(row[region]['datetime']),row[region]['rrp']]);
generation[region].push([Date.parse(row[region]['datetime']),row[region]['generation']]);
demand[region].push([Date.parse(row[region]['datetime']),row[region]['demand']]);
}


          };

for( i =0; i<regions.length; i++){
region = regions[i];
$('#container').highcharts().addSeries({name: region + " $", data: price[region]});
$('#container').highcharts().addSeries({yAxis: 1, visible: false, name: region + " generation", data: generation[region]});
$('#container').highcharts().addSeries({yAxis: 1, visible: false, name: region + " demand", data: demand[region]});
}

    });
    </script>
</head>
<body>
  <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">Nemweb</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
            <li class="active"><a href="#">Home</a></li>
            <li><a href="https://twitter.com/au_nem">Twitter</a></li>
            <li><a href="mailto:nem@mwheeler.org">Contact</a></li>
            <li><a href="https://github.com/TheSkorm/nemweb">Source</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>

<div id="container" style="min-width: 310px; height: 600px; margin: 0 auto"></div>	
<script src="static/js/bootstrap.min.js"></script>
<script>
$(function () {
$('#container').highcharts({
        title: {
            text: 'Nem Data',
            x: -20 //center
        },
        subtitle: {
            text: 'Source: nemweb.com.au',
            x: -20
        },
        xAxis: {
            type: 'datetime',
            dateTimeLabelFormats: { // don't display the dummy year
                month: '%e. %b',
                year: '%b'
            }
        },
yAxis:[{ 
            labels: {
                format: '${value}',
            },
            type: 'logarithmic',
            title: {
                text: 'Price',
            }
        }, { 
            title: {
                text: 'MW',
            },
            labels: {
                format: '{value} MW',
            },
            opposite: true
        }],
        tooltip: {
            valueSuffix: 'MW'
        },
	oposite: true,        
chart: {
            zoomType: 'x'
        },
        legend: {
            borderWidth: 0
}

 });
});
</script>
<script src="http://code.highcharts.com/highcharts.js"></script>
<script src="http://code.highcharts.com/modules/exporting.js"></script>


</body>
</html>
